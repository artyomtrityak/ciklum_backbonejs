define(["text!templates/ciklumer_details.html","text!templates/ciklumer_details_edit.html","lib/bootstrap"],function(e,t){return Backbone.View.extend({el:$("#ciklum-user-details"),template:_.template(e),template_edit:_.template(t),events:{"click .ciklumer-details-edit":"edit_user","click .ciklumer-details-save":"save_user","click .ciklumer-details-remove":"delete_user",error:"show_error"},initialize:function(){},render:function(e){return this.model=e,this.$el.html(this.template(this.model.toJSON())),this},render_edit:function(e){return this.model=e,this.$el.html(this.template_edit(this.model.toJSON())),!1},edit_user:function(){return this.render_edit(this.model),!1},save_user:function(){var e={};return this.$(".ciklum-user-details-edit-input").each(_.bind(function(t,n){var r=$(n).data("field");if(r==="skills"){var i=$(n).val().split(",");i.length===1&&i[0]===""&&(i=[])}else i=$(n).val();e[r]=i},this)),this.model.set(e,{silent:!0}),this.model.save({},{wait:!0,success:_.bind(function(){this.render(this.model)},this),error:_.bind(function(e,t){this.show_error(t),this.model.set(this.model.previousAttributes())},this)}),!1},delete_user:function(){this.model.destroy({wait:!0,success:_.bind(function(){this.$el.html("")},this)})},show_error:function(e){var t=this.$("#ciklumer-error");t.alert().show(),t.find(".ciklumer-error-msg").html(e)}})})